sudo yum install docker -y
sudo systemctl start docker 
sudo systemctl enable docker
sudo usermod -aG docker ec2-user
docker ps
sudo useradd dockeradmin
sudo passwd dockeradmin
sudo usermod -aG docker dockeradmin
groups dockeradmin
sudo nano /etc/ssh/sshd_config
ssh dockeradmin@dockerinstance ip
nano Dockerfile
RUN cp -R /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps/
COPY helloworld.war /usr/local/tomcat/webapps/
exit 
docker pull tomcat
docker images
docker ps
docker run -d --name tomcat-container -p 8080:8081 tomcat
docker ps -a 
docker rm -f tomcat-container
-----in job----------
docker build -t tomcat
docker run -d --name tomcat-container -p 8080:8081 tomcat
-------ansible-------
====in jenkins machine====
sudo yum install ansible -y
ansible --version
ssh-keygen
ssh-copy-id ec2-user@dockermachine
=====in docker machine====
sudo passwd ec2-user
======jenkins machine====
mkdir Ansible 
cd Ansible
nano deploy-git.yaml
---
- name: To install Git on the managed node
  hosts: dockerhost
  become: true
  tasks:
    - name: Install Git
      yum:
        name: git
        state: present
...
nano hosts.ini
[Dockerhost]
<ip of docker]
ansible-playbook -i hosts.ini deploy-git.yaml --syntax-check
ansible-playbook -i hosts.ini deploy-git.yaml
nano deploy-web.yaml
---
- name: To install WebServer  on the managed node
  hosts: dockerhost
  become: true
  tasks:
    - name: Install WebServer
      yum:
        name: nginx
        state: present
    - name: Start the WebServer
      service:
        name: nginx
        state: started
...
nano deploy-webapp.yaml
---
- name: Deploy WAR file in Tomcat Docker Container
  hosts: dockerhost
  become: true
  vars:
    war_file: /var/lib/jenkins/workspace/sample-webapp/target/helloworld.war
    container_name: tomcat1-container
    image_name: tomcat:latest
    host_port: 8083
  tasks:
    - name: Ensure Docker is installed
      yum:
        name: docker
        state: present
    - name: Ensure Docker service is running
      service:
        name: docker
        state: started
        enabled: yes
    - name: Remove any existing container
      community.docker.docker_container:
        name: "{{ container_name }}"
        state: absent
        force_kill: true
    - name: Run new Tomcat container
      community.docker.docker_container:
        name: "{{ container_name }}"
        image: "{{ image_name }}"
        ports:
          - "{{ host_port }}:8080"
        state: started
        restart_policy: always
    - name: Copy Tomcat default apps into webapps
      command: >
        docker exec {{ container_name }} bash -c
        "cp -r /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps"
      ignore_errors: yes
    - name: Copy WAR file to remote EC2
      copy:
        src: "{{ war_file }}"
        dest: /tmp/helloworld.war
    - name: Copy WAR file into container
      command: >
        docker cp /tmp/helloworld.war {{ container_name }}:/usr/local/tomcat/webapps
    - name: Restart Tomcat Container
      community.docker.docker_container:
        name: "{{ container_name }}"
        state: started
        restart: true
...
===in docker machine====
git --version
nginx -version
-------ansible job-------
======in jenkins machine=====
sudo su - jenkins
ssh-keygen
ssh-copy-id ec2-user@jenkinsmachine
ssh ec2-user@jenkins
logout
cd Ansible
sudo usermod -aG ec2-user jenkins
sudo chmod -R g+rx /home/ec2-user
nano hosts.ini
[Dockerhost]
<ip ddress of docker>=ec2-user
cd
sudo systemctl restart jenkins
-------job-----
ansible-playbook -i /home/ec2-user/Ansible/hosts.ini /home/ec2-user/Ansible/docker-webapp.yaml
